---
# tasks file for status server setup
- name: Create status server directory
  ansible.builtin.file:
    path: /var/www/status
    state: directory
    mode: '0755'

- name: Template status server script
  ansible.builtin.template:
    src: status_server.py.j2
    dest: /var/www/status/status_server.py

- name: Template status service file
  ansible.builtin.template:
    src: status.service.j2
    dest: /etc/systemd/system/status.service

- name: Create initial apps.json
  ansible.builtin.copy:
    content: "{}"
    dest: /var/www/status/apps.json
    mode: '0644'

- name: Ensure status service is enabled and started
  ansible.builtin.systemd:
    name: status
    enabled: yes
    state: started
    daemon_reload: yes

- name: Allow status server through UFW
  community.general.ufw:
    rule: allow
    port: "{{ status_port }}"
    proto: tcp
